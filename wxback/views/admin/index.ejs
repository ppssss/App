<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Title</title>
    <link rel="stylesheet" href="/js/bootstrap.css">
    <style>
        html,
        body {
            height: 100%;
            /* width: 100%; */
            overflow: hidden;
        }
        
        body {
            padding: 70px 0 30px 0;
            box-sizing: border-box;
        }
        
        .pub {
            height: 100%;
        }
        
        footer {
            background-color: rgba(188, 250, 255, 0.52);
            line-height: 30px;
        }
        
        main div.lr div.panel-body {
            height: calc(100% - 38px);
            overflow-y: auto;
        }
        #twoSelect{
            margin: 20px auto;
            width: 80%;
        }
        #threeSelect{
            margin: 20px auto;
            width: 80%;
        }
        .navbar1{
            color: white;
            text-align: center;
            font-size: 30px;
        }
    </style>
</head>

<body>
    <nav class="navbar1 navbar navbar-inverse navbar-fixed-top" role="navigation">
        管理员添加页
    </nav>
    <main class="container-fluid pub">
        <div class="row pub">
            <div class="col-md-2 pub">
                <div class="panel panel-primary pub lr">
                    <div class="panel-heading">
                        <h3 class="panel-title">管理控制台</h3>
                    </div>
                    <div class="panel-body" style="overflow: auto;">
                        <ul class="list-unstyled" style="line-height: 40px;">
                            <li>
                                <a href="#one" class="active">添加视频</a>
                            </li>
                            <li>
                                <a href="#two" class="active">添加书本</a>
                            </li>
                            <li>
                                <a href="#three" class="">添加章节</a>
                            </li>
                            <li>
                                <a href="#five" class="">删除视频</a>
                            </li>
                            <li>
                                <a href="#six" class="">修改文章</a>
                            </li>
                            <li>
                                <a href="#seven" class="">修改密码</a>
                            </li>
                            
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-10  pub lr" style="overflow: hidden;">
                <div class="panel panel-primary pub" id="one">
                    <div class="panel-heading">
                        添加视频
                    </div>
                    <div class="panel-body">
                        <form class="form-horizontal" role="form">
                            <div class="form-group has-feedback">
                                <label class="col-sm-1 control-label">标题：</label>
                                <div class="col-sm-10">
                                    <input name='title' class="form-control" placeholder="请输入标题">
                                </div>
                            </div>
                            <div class="form-group has-feedback">
                                <label class="col-sm-1 control-label">视频链接：</label>
                                <div class="col-sm-10">
                                    <textarea name='url' class="form-control" rows="10"></textarea>
                                </div>
                            </div>
                            <div class="form-group has-feedback">
                                <label class="col-sm-1 control-label">封面图片：</label>
                                <div class="col-sm-10">
                                    <input type="file" name='image' class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-2">
                                    <button type="submit" class="btn btn-default">添加</button>
                                </div>
                                <div class="col-sm-2">
                                    <button type="reset" class="btn btn-default">重置</button>
                                </div>
                            </div>
                        </form>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>标题</th>
                                   
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="panel panel-primary pub" id="two">
                    <div class="panel-heading">
                        添加书本
                    </div>           
                    
                    <div class="panel-body">
                        <form class="form-horizontal" role="form">
                            <div id="twoSelect">
                                <select name="artType" required  class="form-control" >
                                <option value="" disabled selected hidden>请选择类型</option>
                                <option value="xh">玄幻</option>
                                <option value="lz">励志</option>
                                <option value="tl">推理</option>
                                <option value="zz">战争</option>
                                <option value="kh">科幻</option>
                                <option value="yq">言情</option>
                            </select>
                            </div>
                            <div class="form-group has-feedback">
                                <label class="col-sm-1 control-label">书名：</label>
                                <div class="col-sm-10">
                                    <input name='title' class="form-control" placeholder="请输入标题">
                                </div>
                            </div>
                            
                            <div class="form-group has-feedback">
                                <label class="col-sm-1 control-label">封面图片：</label>
                                <div class="col-sm-10">
                                    <input type="file" name='image' class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-2">
                                    <button type="submit" class="btn btn-default">添加</button>
                                </div>
                                <div class="col-sm-2">
                                    <button type="reset" class="btn btn-default">重置</button>
                                </div>
                            </div>
                        </form>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>标题</th>
                                   
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
               
                <div class="panel panel-primary pub" id="three">
                    <div class="panel-heading">
                        添加章节
                    </div>
                    <div class="panel-body">
                        <form class="form-horizontal form1" role="form">
                            
                            <div class="form-group has-feedback">
                                <label class="col-sm-1 control-label">内容图片：</label>
                                <div class="col-sm-10">
                                    <input type="file" name='smallSrc' class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-2">
                                    <button type="submit" class="btn btn-default">添加新图片</button>
                                </div>
                            </div>
                        </form>
                        <hr>
                        <form class="form-horizontal form2" role="form">
                            <div id="threeSelect">
                                <select name="artName" required  class="form-control" >
                            </select>
                            </div>
                            <div class="form-group has-feedback">
                                <label class="col-sm-1 control-label">标题：</label>
                                <div class="col-sm-10">
                                    <input name='title' pattern="\S{2,100}" class="form-control" required placeholder="请输入标题">
                                </div>
                            </div>
                            <div class="form-group has-feedback">
                                <label class="col-sm-1 control-label">内容：</label>
                                <div class="col-sm-10">
                                    <textarea name='content' class="form-control" rows="10"><p></p></textarea>
                                </div>
                            </div>
                            <div class="form-group has-feedback">
                                <label class="col-sm-1 control-label">缩率图：</label>
                                <div class="col-sm-10">
                                    <input type="file" name='smallSrc' class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-2">
                                    <button type="submit" class="btn btn-default">添加</button>
                                </div>
                                <div class="col-sm-2">
                                    <button type="reset" class="btn btn-default">重置</button>
                                </div>
                            </div>
                        </form>
                        <ol></ol>
                    </div>
                </div>
                <div class="panel panel-primary pub" id="five">
                    <div class="panel-heading">
                        删除video
                    </div>                    
                    <div class="panel-body">
                        <div class="form-group has-feedback">
                            <form class="form-horizontal form1" role="form">
                                <label class="col-sm-1 control-label">查询标题</label>
                            <div class="col-sm-9">
                                <input name='title' id="videotitle" required class="form-control " placeholder="请输入查询关键字">
                            </div>
                            <div class="col-sm-2">
                                <button id="search" type="submit" class="btn btn-default">查询</button>
                            </div>
                            </form>                            
                        </div>
                        <!-- <select class="form-control" id="fiveSelect">
                            <option value="one">知识</option>
                            <option value="two">热门</option>
                            <option value="three">军事</option>
                            <option value="three">财经</option>
                        </select> -->
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>视频标题</th>
                                    <th>视频链接</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="fiveTbody">
                            </tbody>
                        </table>
                        <div id="fivePage">
                        </div>
                    </div>
                </div>
                <div class="panel panel-primary pub" id="six">
                    <div class="panel-heading">
                        修改文章
                    </div>
                    <div class="panel-body">
                        <div class="panel-body">
                            <form class="form-horizontal form1" role="form">
                                <div  class="form-group has-feedback">
                                   <div  class="col-sm-1">书本名称</div>
                                <div class="col-sm-10" id="sixSelect">
                                    <select name="artName" required  class="form-control" >
                                </select>
                                </div> 
                                </div>
                                
                                <div class="form-group has-feedback">
                                    <label class="col-sm-1 control-label">查询标题</label>
                                    <div class="col-sm-10">
                                        <input name='title' required class="form-control" placeholder="请输入查询关键字">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-4 col-sm-offset-2">
                                        <button type="submit" class="btn btn-default">查询</button>
                                    </div>
                                    <div class="col-sm-2">
                                        <button type="reset" class="btn btn-default">重置</button>
                                    </div>
                                </div>
                            </form>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>标题</th>
                                        <th>日期</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="sixTbody">
                                </tbody>
                            </table>
                            <hr>
                            <form class="form-horizontal form2" role="form">
                                <div class="form-group has-feedback">
                                    <label class="col-sm-1 control-label">标题：</label>
                                    <div class="col-sm-10">
                                        <input name='title' pattern="\S{2,100}" class="form-control title" required placeholder="请修改标题">
                                        <input name='id' type="hidden" class="id">
                                    </div>
                                </div>
                                <div class="form-group has-feedback">
                                    <label class="col-sm-1 control-label">内容：</label>
                                    <div class="col-sm-10">
                                        <textarea name='content' class="form-control content" rows="10"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-4 col-sm-offset-2">
                                        <button type="submit" class="btn btn-default">修改</button>
                                    </div>
                                    <div class="col-sm-2">
                                        <button type="reset" class="btn btn-default">重置</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
    </main>
    <footer class="footer navbar-fixed-bottom">
        <ul class="list-inline text-center" style="margin-bottom: 0">
            <li><a href="http://www.miibeian.gov.cn/" target="_blank">京ICP备11008151号</a></li>
            <li>京公网安备11010802014853</li>
        </ul>
    </footer>
    <script src="/js/jquery-2.1.3.js"></script>
    <script src="/js/com.js"></script>
    <script>
        //------------------------------添加视频------------------------------------
        let one = document.getElementById('one');
        let oneForm = one.querySelector('form');
        let oneTbody = one.querySelector('tbody');
        oneForm.onsubmit = function(e) {
                e = e || event;
                e.preventDefault();
                let data = new FormData(this);
                console.log(data);
                $.ajax({
                    url: "/admin/addVideo",
                    type: "post",
                    data,
                    dataType: "json",
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function(rs) {
                       
                            let tr = document.createElement('tr');
                            let td = document.createElement('td');
                            td.innerText = rs.title;
                            tr.appendChild(td);
                            oneTbody.appendChild(tr)
                       
                    },
                    error: function() {
                        alert('操作失败')
                    }
                });
                return false
            }
            //------------------------------添加书本------------------------------------
        let two = document.getElementById('two');
        let TwoSelect=document.getElementById('twoSelect');
        let twoForm = two.querySelector('form');
        let twoTbody = two.querySelector('tbody');
        let artType=''
        TwoSelect.onchange=function(){
            artType=this.value
        }
        twoForm.onsubmit = function(e) {
                e = e || event;
                e.preventDefault();
                let data =new FormData(this);
                $.ajax({
                    url: "/admin/addArtType",
                    type: "post",
                    data,
                    dataType: "json",
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function(rs) {
                        console.log(rs);                       
                            let tr = document.createElement('tr');
                            let td = document.createElement('td');
                            td.innerText = rs.title;
                            tr.appendChild(td);
                            twoTbody.appendChild(tr)
                       
                    },
                    error: function() {
                        alert('操作失败')
                    }
                });
                return false
            }
           
            //------------------------------添加章节------------------------------------
        let three = document.getElementById('three');
        let threeForm1 = three.querySelector('.form1');
        let threeForm2 = three.querySelector('.form2');
        let threeTextarea = three.querySelector('textarea');
        let threeOl = three.querySelector('ol');
        let threeSelece=three.querySelector('select')
        window.onload= function getArt(){
            $.getJSON('/admin/getArt', function(obj) {
                console.log(obj);
                let str='<option value="" disabled selected hidden>请选择书本</option>'
                obj.map(el=>{
                   str+= `<option value=${el.title}>${el.title}</option>`
                })
                console.log(str);
                threeSelece.innerHTML=str
            })
        }
        threeForm1.onsubmit = function() {
            let data = new FormData(this);
            $.ajax({
                url: "/admin/newImg",
                type: "post",
                data,
                dataType: "json",
                cache: false,
                contentType: false,
                processData: false,
                success: function(filename) {
                    if (filename)
                        threeTextarea.value += `<img src="{{imgUrl}}/upload/${filename}"/><p></p>`;
                    else
                        alert('你忘了选择图片！')
                },
                error: function() {
                    alert('操作失败')
                }
            });
            return false
        }
        threeForm2.onsubmit = function() {
            let data = new FormData(this);
            $.ajax({
                url: "/admin/addArticle",
                type: "post",
                data,
                dataType: "json",
                cache: false,
                contentType: false,
                processData: false,
                success: function(filename) {
                    if (filename)
                    threeOl.innerHTML += '<li>' + filename.title + '</li>'
                    else
                        alert('你忘了选择图片！')
                },
                error: function() {
                    alert('操作失败')
                }
            });
                return false
            }
               //------------------------------删除视频------------------------------------
        let five = document.getElementById('five');
        let fiveForm=five.querySelector('.form1');
        
        let fivePage = document.getElementById('fivePage');
        let fiveTbody = document.getElementById('fiveTbody');
        let fiveNum = 0; //代表当前页
        let fivePages = 0; //当前总页
        let dataType='';

        fiveForm.onsubmit=function(){
            var inputValue = document.getElementById("videotitle").value;
            console.log(inputValue);
            showRecord()
            return false
        }

        function showRecord() {
            var inputValue = document.getElementById("videotitle").value;
            const json={pageNum:fiveNum,title:inputValue}
            console.log(json);
            $.getJSON('/admin/getvideo',json, function(obj) {
                if(obj.arr.length==0){
                    alert('没找到数据')
                }else{
                    let str = '';
                obj.arr.forEach(el => {
                    str += `<tr>
                                <td>${el.title}</td>
                                <td>${el.url}</td>
                                <td>
                                     <button data-id=${el.id}>删除</button>
                                </td>
                        </tr>`
                });
                fiveTbody.innerHTML = str;
                fivePages = Math.ceil(obj.num / 5);
                pagination1() 
                }               
            })
        }

        function pagination1() {
            let str = `<ul class="pagination pull-right">`;
            for (let i = 0; i < fivePages; i++) {
                str += `<li class="${i===fiveNum?'active':''}" data-index=${i}><a href="##">${i+1}</a></li>`;
            }
            fivePage.innerHTML = str + '</ul>';
        }
        com.agent1('fivePage', 'click', 'li', function() {
            fiveNum = this.getAttribute('data-index') - 0;
            showRecord()
        });
        com.agent1('fiveTbody', 'click', 'button', function() {
                let id = this.getAttribute('data-id');
                if (confirm('你确定要删除吗')) {
                    $.getJSON('/admin/delVideo?id=' + id, function(records) {
                        if (records) {
                            alert('删除成功');
                            fiveTbody.innerHTML=null;
                            if (records === (fivePages - 1) * 5 && fiveNum === fivePages - 1) {
                                fiveNum = fiveNum > 0 ? (fiveNum - 1) : 0;
                            }
                            showRecord()
                        } else
                            alert('删除失败')
                    })
                }
            })
              //------------------------------修改------------------------------------
        let six = document.getElementById('six');
        let sixSelect=six.querySelector('Select');
        let sixTbody = document.getElementById('sixTbody');
        let sixForm1 = six.querySelector('.form1');
        let sixForm2 = six.querySelector('.form2');
        let sixTitle = sixForm2.querySelector('.title');
        let sixId = sixForm2.querySelector('.id');
        let sixContent = sixForm2.querySelector('.content');

        window.onload= function getArt(){
            $.getJSON('/admin/getArt', function(obj) {
                console.log(obj);
                let str='<option value="" disabled selected hidden>请选择书本</option>'
                obj.map(el=>{
                   str+= `<option value=${el.title}>${el.title}</option>`
                })
                console.log(str);
                sixSelect.innerHTML=str
            })
        }

        sixForm1.onsubmit = function() {
            $.getJSON('/admin/select', $(this).serialize(), function(rs) {
                let str = '';
                rs.forEach(el => {
                    str += `<tr><td>${el.title}</td><td>${el.date}</td><td><button data-id="${el.id}">选择</button></td></tr>`
                });
                sixTbody.innerHTML = str;
            })
            return false
        }
        com.agent1('sixTbody', 'click', 'button', function() {
            let id = this.getAttribute('data-id');
            $.getJSON('/admin/selectId?id=' + id, function(rs) {
                sixId.value = rs.id;
                sixTitle.value = rs.title;
                sixContent.value = rs.content;
            })
        });
        sixForm2.onsubmit = function() {
                $.post('/admin/changeNew', $(this).serialize(), function(obj) {
//                  console.log(obj);
alert('修改成功')
                }, 'json')
                return false
            }
           
           
    </script>
</body>

</html>